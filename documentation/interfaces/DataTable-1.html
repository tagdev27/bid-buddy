<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>bid-buddy documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/stripe.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">bid-buddy documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>DataTable</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/bids/bids.component.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>model interface for table header, footer, and data</p>

            </p>


        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#dataRows">dataRows</a>
                                </li>
                                <li>
                                        <a href="#footerRow">footerRow</a>
                                </li>
                                <li>
                                        <a href="#headerRow">headerRow</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="dataRows"></a>
                                        <span class="name"><b>dataRows</b><a href="#dataRows"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>dataRows:     <code>string[][]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string[][]</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="footerRow"></a>
                                        <span class="name"><b>footerRow</b><a href="#footerRow"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>footerRow:     <code>string[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string[]</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="headerRow"></a>
                                        <span class="name"><b>headerRow</b><a href="#headerRow"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>headerRow:     <code>string[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string[]</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, AfterViewInit } from &#x27;@angular/core&#x27;;
import * as firebase from &quot;firebase&quot;;
import swal from &#x27;sweetalert2&#x27;;
import * as $ from &#x27;jquery&#x27;;
import * as Chartist from &#x27;chartist&#x27;;
import &#x27;datatables.net&#x27;;
import &#x27;datatables.net-bs4&#x27;;
import { OverlayService } from &#x27;../overlay/overlay.module&#x27;;
import { ProgressSpinnerComponent } from &#x27;../progress-spinner/progress-spinner.module&#x27;;

import { AppConfig } from &quot;src/app/services/global.service&quot;;
import { Merchants } from &#x27;../models/merchant&#x27;;
import { AdminUsers } from &#x27;../models/admin.users&#x27;;
import { Users } from &#x27;../models/users&#x27;;
import { Product } from &#x27;../models/product&#x27;;
import { Bids } from &#x27;../models/bids&#x27;;
import { BidRate } from &#x27;../models/bidvalue&#x27;;
import { ActivatedRoute, Router } from &#x27;@angular/router&#x27;;

/**
 * model interface for table header, footer, and data
 */
declare interface DataTable {
    headerRow: string[];
    footerRow: string[];
    dataRows: string[][];
}

/**
 * model interface for drop down items
 */
declare interface dropDownItems {
    value: string
    display: string
    id: string
}

@Component({
    selector: &#x27;app-bids&#x27;,
    templateUrl: &#x27;bids.component.html&#x27;
})
export class BidsComponent implements OnInit, AfterViewInit {

    public tableData: DataTable;

    constructor(private previewProgressSpinner: OverlayService, private _Activatedroute:ActivatedRoute, private router:Router) { }

    public dataTable: DataTable;
    config &#x3D; new AppConfig()
    data: string[][] &#x3D; []
    users: Users[] &#x3D; []
    products: Product[] &#x3D; []
    merchants: Merchants[] &#x3D; []
    bids: Bids[] &#x3D; []
    bidRates: BidRate[] &#x3D; []

    /**
     *Insert drop down items inside merchants, products, customers, and bid rates array
     */
    dropDown_merchants: dropDownItems[] &#x3D; []
    dropDown_customers: dropDownItems[] &#x3D; []
    dropDown_products: dropDownItems[] &#x3D; []
    dropDown_bidrates: dropDownItems[] &#x3D; []

    addNewPro &#x3D; true
    authorized &#x3D; false
    editPro &#x3D; false
    currentProRow: Bids
    bids_type &#x3D; &#x27;All&#x27;

    selectedProduct: Bids
    isDeletedView &#x3D; false

    ///////////////////////
    model_merchants: dropDownItems[] &#x3D; []
    model_customers: dropDownItems[] &#x3D; []
    model_products: dropDownItems[] &#x3D; []
    model_bidrates: dropDownItems[] &#x3D; []
    bid_value &#x3D; 0 //do calc
    bid_rev &#x3D; 0 //do calc
    bid_swipe_action &#x3D; &#x27;&#x27;
    status &#x3D; &#x27;&#x27;

    /**
     * @returns an integer for calculating the bid value provided
     * 
     * the swipe action, number of swipes, and value of swipe per swipe
     */
    getBidValue(): Number {
        if (this.model_bidrates.length &lt;&#x3D; 0) {
            return;
        }
        const b_id &#x3D; this.model_bidrates[0].id
        const curr_bid_rate &#x3D; this.bidRates.filter((bid, index, arr) &#x3D;&gt; {
            return bid.bid_rate_id &#x3D;&#x3D; b_id
        })
        const swipe_no &#x3D; curr_bid_rate[0].bid_rate_swipe_number
        const swipe_value &#x3D; curr_bid_rate[0].bid_rate_swipe_value
        const swipe_action &#x3D; (this.bid_swipe_action &#x3D;&#x3D; &#x27;like&#x27;) ? 1 : 0
        const calc &#x3D; swipe_action * swipe_value * swipe_no
        this.bid_value &#x3D; calc
        return calc
    }

    swipe_action_data &#x3D; [
        { value: &#x27;like&#x27;, viewValue: &#x27;Like&#x27; },
        { value: &#x27;dislike&#x27;, viewValue: &#x27;DisLike&#x27; },
    ]

    status_data &#x3D; [
        { value: &#x27;pending&#x27;, viewValue: &#x27;Pending&#x27; },
        { value: &#x27;progress&#x27;, viewValue: &#x27;Progress&#x27; },
        { value: &#x27;completed&#x27;, viewValue: &#x27;Completed&#x27; },
    ]

    isMerchantAccount &#x3D; false
    business_owner &#x3D; &#x27;&#x27;
    filter_type &#x3D; &#x27;all&#x27;
    display_main_row &#x3D; false
    ///////////////////////

    clearField() {
        this.bid_value &#x3D; 0
        this.bid_rev &#x3D; 0
        this.bid_swipe_action &#x3D; &#x27;&#x27;
        this.status &#x3D; &#x27;&#x27;
        this.model_merchants &#x3D; []
        this.model_customers &#x3D; []
        this.model_products &#x3D; []
        this.model_bidrates &#x3D; []
    }

    ngOnDestroy() {

    }

    total_bids &#x3D; 0
    pending_bids &#x3D; 0
    progress_bids &#x3D; 0
    completed_bids &#x3D; 0

    /**
     * get the current user and determine if user is a merchant or admin staff.
     */
    getCurrentUser() {
        const email &#x3D; localStorage.getItem(&#x27;email&#x27;)
        firebase.firestore().collection(&#x27;db&#x27;).doc(&#x27;bidbuddy&#x27;).collection(&#x27;users&#x27;).doc(email).get().then(u &#x3D;&gt; {
            const user &#x3D; &lt;AdminUsers&gt;u.data()
            if (user.role &#x3D;&#x3D; &#x27;Merchant&#x27;) {
                this.isMerchantAccount &#x3D; true
                this.business_owner &#x3D; user.business_owner
            }
        })
    }

    ngOnInit() {
        this._Activatedroute.params.subscribe(p &#x3D;&gt; {
            this.filter_type &#x3D; p[&#x27;filter&#x27;]
        })
        this.getCurrentUser()
        this.getUsers()
        this.getMerchants()
        this.getProducts()
        this.getBidRates()
        if(this.filter_type &#x3D;&#x3D; &#x27;all&#x27; || this.filter_type &#x3D;&#x3D; null){
            this.getBids()
        }else {
            this.getBidsByType(this.filter_type)
        }
    }

    /**
     * displays pie chart of all bids categorized by its status
     */
    pieChartSection() {
        /*  **************** Public Preferences - Pie Chart ******************** */

        const dataPreferences &#x3D; {
            labels: [&#x60;${this.pending_bids}%&#x60;, &#x60;${this.progress_bids}%&#x60;, &#x60;${this.completed_bids}%&#x60;],
            series: [this.pending_bids, this.progress_bids, this.completed_bids]
        };

        const optionsPreferences &#x3D; {
            height: &#x27;230px&#x27;
        };

        new Chartist.Pie(&#x27;#chartPreferences&#x27;, dataPreferences, optionsPreferences);
    }

    addPro() {
        this.addNewPro &#x3D; true
        this.authorized &#x3D; true
        //this.addNewCat2 &#x3D; true
    }

    cancelAddPro() {
        this.addNewPro &#x3D; false
        this.authorized &#x3D; false
        //this.addNewCat2 &#x3D; false
        this.editPro &#x3D; false
        this.clearField()
    }

    /**
     * get all registered merchants
     */
    getMerchants() {
        firebase.firestore().collection(&#x27;db&#x27;).doc(&#x27;bidbuddy&#x27;).collection(&#x27;merchants&#x27;).get().then(query &#x3D;&gt; {
            //this.data &#x3D; []
            this.merchants &#x3D; []
            query.forEach(async data &#x3D;&gt; {
                const mer &#x3D; &lt;Merchants&gt;data.data()
                this.merchants.push(mer)
                this.dropDown_merchants.push({ display: mer.business_name, value: mer.business_name, id: mer.id })
            })
        });
    }

    /**
     * get all products
     */
    getProducts() {
        firebase.firestore().collection(&#x27;db&#x27;).doc(&#x27;bidbuddy&#x27;).collection(&#x27;products&#x27;).get().then(query &#x3D;&gt; {//where(&quot;deleted&quot;, &quot;&#x3D;&#x3D;&quot;, false).
            this.products &#x3D; []
            query.forEach(async data &#x3D;&gt; {
                const pro &#x3D; &lt;Product&gt;data.data()
                this.products.push(pro)
                const mer &#x3D; await this.getMerchantByProductID(pro.merchant_id)
                // console.log(mer.business_name)
                this.dropDown_products.push({ display: &#x60;${pro.name} - ${mer.business_name}&#x60;, value: &#x60;${pro.name}&#x60;, id: pro.id })
            })
        });
    }

    /**
     * get the owner (merchant) of the product by providing the product id.
     * @param {string} id the product id
     * @returns the merchant object that uploaded the product
     */
    async getMerchantByProductID(id: string) {
        const getC &#x3D; await firebase.firestore().collection(&#x27;db&#x27;).doc(&#x27;bidbuddy&#x27;).collection(&#x27;merchants&#x27;).doc(id).get()
        return &lt;Merchants&gt;getC.data()
    }

    /**
     * get list of all customers
     */
    getUsers() {
        firebase.firestore().collection(&#x27;customers&#x27;).onSnapshot(query &#x3D;&gt; {
            this.users &#x3D; []
            query.forEach(data &#x3D;&gt; {
                const user &#x3D; &lt;Users&gt;data.data()
                this.users.push(user)
                this.dropDown_customers.push({ display: user.email, value: user.email, id: user.email })
            })
        });
    }

    /**
     * get list of all bid rates
     */
    getBidRates() {
        firebase.firestore().collection(&#x27;db&#x27;).doc(&#x27;bidbuddy&#x27;).collection(&#x27;bidrate&#x27;).get().then(query &#x3D;&gt; {
            this.bidRates &#x3D; []
            query.forEach(data &#x3D;&gt; {
                const br &#x3D; &lt;BidRate&gt;data.data()
                this.bidRates.push(br)
                this.dropDown_bidrates.push({ display: br.bid_rate_name, value: br.bid_rate_name, id: br.bid_rate_id })
            })
        });
    }

    /**
     * get all bids and displays accordingly to the merchant or admin
     */
    getBids() {
        if (this.isMerchantAccount) {
            firebase.firestore().collection(&#x27;bids&#x27;).where(&#x27;merchant_id&#x27;, &#x27;&#x3D;&#x3D;&#x27;, this.business_owner).onSnapshot(query &#x3D;&gt; {
                this.data &#x3D; []
                this.bids &#x3D; []
                var index &#x3D; 0
                query.forEach(async data &#x3D;&gt; {
                    const bid &#x3D; &lt;Bids&gt;data.data()
                    this.bids.push(bid)
                    //filter customer
                    const customer &#x3D; this.users.filter((user, index, array) &#x3D;&gt; {
                        return user.email &#x3D;&#x3D; bid.customer_id
                    })
                    //filter product
                    const product &#x3D; this.products.filter((pro, index, array) &#x3D;&gt; {
                        return pro.id &#x3D;&#x3D; bid.product_id
                    })
                    //filter merchant
                    const merchant &#x3D; this.merchants.filter((mer, index, array) &#x3D;&gt; {
                        return mer.id &#x3D;&#x3D; bid.merchant_id
                    })
                    //filter bidrates
                    const bidrate &#x3D; this.bidRates.filter((bidr, index, array) &#x3D;&gt; {
                        return bidr.bid_rate_id &#x3D;&#x3D; bid.bid_rate_id
                    })
                    var amount &#x3D; &#x27;₦0&#x27;
                    if (customer[0].bid_tokens !&#x3D; null) {
                        amount &#x3D; &#x60;₦${customer[0].bid_tokens[&#x27;amount&#x27;]}&#x60;
                    }
                    this.data.push([&#x60;${index}&#x60;, customer[0].fullName, customer[0].email, amount, product[0].name, product[0].deliver_type, &#x60;₦${product[0].price}&#x60;, merchant[0].business_name, &#x60;${bidrate[0].bid_rate_swipe_number}&#x60;, &#x60;₦${bidrate[0].bid_rate_swipe_value}&#x60;, &#x60;₦${bid.bid_value}&#x60;, &#x60;₦${bid.bid_revenue}&#x60;, bid.bid_swipe_action, bid.bid_status, bid.created_date, bid.modified_date])
                    index &#x3D; index + 1
                })
                this.dataTable &#x3D; {
                    headerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                    footerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                    dataRows: this.data
                };
                this.total_bids &#x3D; this.bids.length
                const pending &#x3D; this.bids.filter((b, index, array) &#x3D;&gt; {
                    return b.bid_status &#x3D;&#x3D; &#x27;pending&#x27;
                })
                const progress &#x3D; this.bids.filter((b, index, array) &#x3D;&gt; {
                    return b.bid_status &#x3D;&#x3D; &#x27;progress&#x27;
                })
                const comp &#x3D; this.bids.filter((b, index, array) &#x3D;&gt; {
                    return b.bid_status &#x3D;&#x3D; &#x27;completed&#x27;
                })
                this.pending_bids &#x3D; pending.length
                this.progress_bids &#x3D; progress.length
                this.completed_bids &#x3D; comp.length
                this.pieChartSection()
            })
            return
        }
        firebase.firestore().collection(&#x27;bids&#x27;).onSnapshot(query &#x3D;&gt; {
            this.data &#x3D; []
            this.bids &#x3D; []
            var index &#x3D; 0
            query.forEach(async data &#x3D;&gt; {
                const bid &#x3D; &lt;Bids&gt;data.data()
                this.bids.push(bid)
                //filter customer
                const customer &#x3D; this.users.filter((user, index, array) &#x3D;&gt; {
                    return user.email &#x3D;&#x3D; bid.customer_id
                })
                //filter product
                const product &#x3D; this.products.filter((pro, index, array) &#x3D;&gt; {
                    return pro.id &#x3D;&#x3D; bid.product_id
                })
                //filter merchant
                const merchant &#x3D; this.merchants.filter((mer, index, array) &#x3D;&gt; {
                    return mer.id &#x3D;&#x3D; bid.merchant_id
                })
                //filter bidrates
                const bidrate &#x3D; this.bidRates.filter((bidr, index, array) &#x3D;&gt; {
                    return bidr.bid_rate_id &#x3D;&#x3D; bid.bid_rate_id
                })
                var amount &#x3D; &#x27;₦0&#x27;
                if (customer[0].bid_tokens !&#x3D; null) {
                    amount &#x3D; &#x60;₦${customer[0].bid_tokens[&#x27;amount&#x27;]}&#x60;
                }
                this.data.push([&#x60;${index}&#x60;, customer[0].fullName, customer[0].email, amount, product[0].name, product[0].deliver_type, &#x60;₦${product[0].price}&#x60;, merchant[0].business_name, &#x60;${bidrate[0].bid_rate_swipe_number}&#x60;, &#x60;₦${bidrate[0].bid_rate_swipe_value}&#x60;, &#x60;₦${bid.bid_value}&#x60;, &#x60;₦${bid.bid_revenue}&#x60;, bid.bid_swipe_action, bid.bid_status, bid.created_date, bid.modified_date])
                index &#x3D; index + 1
            })
            this.dataTable &#x3D; {
                headerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                footerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                dataRows: this.data
            };
            this.total_bids &#x3D; this.bids.length
            const pending &#x3D; this.bids.filter((b, index, array) &#x3D;&gt; {
                return b.bid_status &#x3D;&#x3D; &#x27;pending&#x27;
            })
            const progress &#x3D; this.bids.filter((b, index, array) &#x3D;&gt; {
                return b.bid_status &#x3D;&#x3D; &#x27;progress&#x27;
            })
            const comp &#x3D; this.bids.filter((b, index, array) &#x3D;&gt; {
                return b.bid_status &#x3D;&#x3D; &#x27;completed&#x27;
            })
            this.pending_bids &#x3D; Number(((pending.length/this.total_bids)*100).toFixed(0))
            this.progress_bids &#x3D; Number(((progress.length/this.total_bids)*100).toFixed(0))
            this.completed_bids &#x3D; Number(((comp.length/this.total_bids)*100).toFixed(0))
            this.pieChartSection()
        })
    }

    /**
     * get all bids based on its status where the pie chart legend is clicked
     * @param {string} status the status of the bid must be provided
     */
    onPieChartLegendsClicked(status: string){
        this.addNewPro &#x3D; false
        this.bids_type &#x3D; status.toLocaleUpperCase()
        this.getBidsByType(status)
    }

    /**
     * get all bids based on its status
     */
    getBidsByType(status: string) {
        this.bids_type &#x3D; status.toLocaleUpperCase()
        if (this.isMerchantAccount) {
            firebase.firestore().collection(&#x27;bids&#x27;).where(&#x27;merchant_id&#x27;, &#x27;&#x3D;&#x3D;&#x27;, this.business_owner).where(&#x27;bid_status&#x27;, &#x27;&#x3D;&#x3D;&#x27;, status).onSnapshot(query &#x3D;&gt; {
                this.data &#x3D; []
                this.bids &#x3D; []
                var index &#x3D; 0
                query.forEach(async data &#x3D;&gt; {
                    const bid &#x3D; &lt;Bids&gt;data.data()
                    this.bids.push(bid)
                    //filter customer
                    const customer &#x3D; this.users.filter((user, index, array) &#x3D;&gt; {
                        return user.email &#x3D;&#x3D; bid.customer_id
                    })
                    //filter product
                    const product &#x3D; this.products.filter((pro, index, array) &#x3D;&gt; {
                        return pro.id &#x3D;&#x3D; bid.product_id
                    })
                    //filter merchant
                    const merchant &#x3D; this.merchants.filter((mer, index, array) &#x3D;&gt; {
                        return mer.id &#x3D;&#x3D; bid.merchant_id
                    })
                    //filter bidrates
                    const bidrate &#x3D; this.bidRates.filter((bidr, index, array) &#x3D;&gt; {
                        return bidr.bid_rate_id &#x3D;&#x3D; bid.bid_rate_id
                    })
                    var amount &#x3D; &#x27;₦0&#x27;
                    if (customer[0].bid_tokens !&#x3D; null) {
                        amount &#x3D; &#x60;₦${customer[0].bid_tokens[&#x27;amount&#x27;]}&#x60;
                    }
                    this.data.push([&#x60;${index}&#x60;, customer[0].fullName, customer[0].email, amount, product[0].name, product[0].deliver_type, &#x60;₦${product[0].price}&#x60;, merchant[0].business_name, &#x60;${bidrate[0].bid_rate_swipe_number}&#x60;, &#x60;₦${bidrate[0].bid_rate_swipe_value}&#x60;, &#x60;₦${bid.bid_value}&#x60;, &#x60;₦${bid.bid_revenue}&#x60;, bid.bid_swipe_action, bid.bid_status, bid.created_date, bid.modified_date])
                    index &#x3D; index + 1
                })
                this.dataTable &#x3D; {
                    headerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                    footerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                    dataRows: this.data
                };
            })
            return
        }
        firebase.firestore().collection(&#x27;bids&#x27;).where(&#x27;bid_status&#x27;, &#x27;&#x3D;&#x3D;&#x27;, status).onSnapshot(query &#x3D;&gt; {
            this.data &#x3D; []
            this.bids &#x3D; []
            var index &#x3D; 0
            query.forEach(async data &#x3D;&gt; {
                const bid &#x3D; &lt;Bids&gt;data.data()
                this.bids.push(bid)
                //filter customer
                const customer &#x3D; this.users.filter((user, index, array) &#x3D;&gt; {
                    return user.email &#x3D;&#x3D; bid.customer_id
                })
                //filter product
                const product &#x3D; this.products.filter((pro, index, array) &#x3D;&gt; {
                    return pro.id &#x3D;&#x3D; bid.product_id
                })
                //filter merchant
                const merchant &#x3D; this.merchants.filter((mer, index, array) &#x3D;&gt; {
                    return mer.id &#x3D;&#x3D; bid.merchant_id
                })
                //filter bidrates
                const bidrate &#x3D; this.bidRates.filter((bidr, index, array) &#x3D;&gt; {
                    return bidr.bid_rate_id &#x3D;&#x3D; bid.bid_rate_id
                })
                var amount &#x3D; &#x27;₦0&#x27;
                if (customer[0].bid_tokens !&#x3D; null) {
                    amount &#x3D; &#x60;₦${customer[0].bid_tokens[&#x27;amount&#x27;]}&#x60;
                }
                this.data.push([&#x60;${index}&#x60;, customer[0].fullName, customer[0].email, amount, product[0].name, product[0].deliver_type, &#x60;₦${product[0].price}&#x60;, merchant[0].business_name, &#x60;${bidrate[0].bid_rate_swipe_number}&#x60;, &#x60;₦${bidrate[0].bid_rate_swipe_value}&#x60;, &#x60;₦${bid.bid_value}&#x60;, &#x60;₦${bid.bid_revenue}&#x60;, bid.bid_swipe_action, bid.bid_status, bid.created_date, bid.modified_date])
                index &#x3D; index + 1
            })
            this.dataTable &#x3D; {
                headerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                footerRow: [&#x27;Customer Name&#x27;, &#x27;Customer Email&#x27;, &#x27;Customer Current Balance&#x27;, &#x27;Product Name&#x27;, &#x27;Product Type&#x27;, &#x27;Product Price&#x27;, &#x27;Merchant Name&#x27;, &#x27;No of Swipes&#x27;, &#x27;Swipe Value&#x27;, &#x27;Bid Value&#x27;, &#x27;Bid Revenue&#x27;, &#x27;Swipe Action&#x27;, &#x27;Status&#x27;, &#x27;Created Date&#x27;, &#x27;Modified Date&#x27;, &#x27;Action&#x27;],
                dataRows: this.data
            };
        })
    }

    /**
     * submit a new bid
     */
    bidSubmitClicked() {
        //filter customer
        const customer &#x3D; this.users.filter((user, index, array) &#x3D;&gt; {
            return user.email &#x3D;&#x3D; this.model_customers[0].id
        })
        //filter product
        const product &#x3D; this.products.filter((pro, index, array) &#x3D;&gt; {
            return pro.id &#x3D;&#x3D; this.model_products[0].id
        })
        //filter merchant
        const merchant &#x3D; this.merchants.filter((mer, index, array) &#x3D;&gt; {
            return mer.id &#x3D;&#x3D; this.model_merchants[0].id
        })
        //filter bidrates
        const bidrate &#x3D; this.bidRates.filter((bidr, index, array) &#x3D;&gt; {
            return bidr.bid_rate_id &#x3D;&#x3D; this.model_bidrates[0].id
        })
        if (
            this.bid_value &#x3D;&#x3D; 0 ||
            this.bid_rev &#x3D;&#x3D; 0 ||
            this.bid_swipe_action &#x3D;&#x3D; &#x27;&#x27; ||
            this.status &#x3D;&#x3D; &#x27;&#x27; ||
            this.model_merchants.length &#x3D;&#x3D; 0 ||
            this.model_customers.length &#x3D;&#x3D; 0 ||
            this.model_products.length &#x3D;&#x3D; 0 ||
            this.model_bidrates.length &#x3D;&#x3D; 0
        ) {//|| this.basket_items.length &#x3D;&#x3D; 0
            this.config.displayMessage(&quot;All fields are required&quot;, false)
            return
        }
        this.previewProgressSpinner.open({ hasBackdrop: true }, ProgressSpinnerComponent);
        if (!this.editPro) {//new add
            const key &#x3D; firebase.database().ref().push().key
            const current_email &#x3D; localStorage.getItem(&#x27;email&#x27;)
            const current_name &#x3D; localStorage.getItem(&#x27;name&#x27;)
            const bid: Bids &#x3D; {
                id: key,
                customer_id: customer[0].email,
                merchant_id: merchant[0].id,
                product_id: product[0].id,
                bid_rate_id: bidrate[0].bid_rate_id,
                bid_value: this.bid_value,
                bid_revenue: this.bid_rev,
                bid_swipe_action: this.bid_swipe_action,
                bid_status: this.status,
                created_date: &#x60;${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}&#x60;,
                created_by: &#x60;${current_name}|${current_email}&#x60;,
                modified_date: &#x60;${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}&#x60;
            }
            firebase.firestore().collection(&#x27;bids&#x27;).doc(key).set(bid).then(d &#x3D;&gt; {
                var amount &#x3D; 0
                if (customer[0].bid_tokens !&#x3D; null) {
                    amount &#x3D; Number(&#x60;${customer[0].bid_tokens[&#x27;amount&#x27;]}&#x60;)
                }
                const cust_token &#x3D; amount - this.bid_value
                const bid_token_for_customer &#x3D; {
                    &#x27;amount&#x27;: cust_token,
                }
                firebase.firestore().collection(&#x27;customers&#x27;).doc(customer[0].email).update({ &#x27;bid_tokens&#x27;: bid_token_for_customer }).then(d &#x3D;&gt; {
                    this.config.logActivity(&#x60;${current_name}|${current_email} created this bid: ${product[0].name}/${merchant[0].business_name}/${bidrate[0].bid_rate_name}/${customer[0].fullName}&#x60;)
                    this.previewProgressSpinner.close()
                    this.config.displayMessage(&#x60;Bid created successfully.&#x60;, true);
                    this.addNewPro &#x3D; false
                    this.editPro &#x3D; false
                    this.clearField()
                })
            }).catch(err &#x3D;&gt; {
                this.previewProgressSpinner.close()
                this.config.displayMessage(&#x60;${err}&#x60;, false);
            })
        } else {//update
            this.updateValues(customer[0].email, merchant[0].id, product[0].id, bidrate[0].bid_rate_id)
        }

    }

    /**
     * updating bid fields
     */
    updateValues(cus_id: string, mer_id: string, pro_id: string, br_id: string) {
        const updatedBid: Bids &#x3D; {
            customer_id: cus_id,
            merchant_id: mer_id,
            product_id: pro_id,
            bid_rate_id: br_id,
            bid_value: this.bid_value,
            bid_revenue: this.bid_rev,
            bid_swipe_action: this.bid_swipe_action,
            bid_status: this.status,
            modified_date: &#x60;${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}&#x60;,
        }
        const current_email &#x3D; localStorage.getItem(&#x27;email&#x27;)
        const current_name &#x3D; localStorage.getItem(&#x27;name&#x27;)
        firebase.firestore().collection(&#x27;bids&#x27;).doc(this.currentProRow.id).update(updatedBid).then(d &#x3D;&gt; {
            this.config.logActivity(&#x60;${current_name}|${current_email} updated this bid: ${this.currentProRow.id}&#x60;)
            this.previewProgressSpinner.close()
            this.config.displayMessage(&#x60;Bid updated successfully.&#x60;, true);
            this.addNewPro &#x3D; false
            this.editPro &#x3D; false
            this.clearField()
        }).catch(err &#x3D;&gt; {
            this.previewProgressSpinner.close()
            this.config.displayMessage(&#x60;${err}&#x60;, false);
        })
    }

    /**
     * deletes a particular bid by providing the bid id
     * @param {any} _id bid id
     */
    deletePro(_id: any) {
        const index &#x3D; Number(_id)
        const id &#x3D; &#x60;${this.bids[index].id}&#x60;
        const name &#x3D; &#x60;${this.bids[index].id}&#x60;
        swal({
            title: &#x27;Delete Alert&#x27;,
            text: &#x27;Are you sure about deleting this bid?&#x27;,
            type: &#x27;warning&#x27;,
            showCancelButton: true,
            confirmButtonText: &#x27;Yes, delete it!&#x27;,
            cancelButtonText: &#x27;No, keep it&#x27;,
            confirmButtonClass: &quot;btn btn-success&quot;,
            cancelButtonClass: &quot;btn btn-danger&quot;,
            buttonsStyling: false
        }).then((result) &#x3D;&gt; {
            if (result.value) {
                firebase.firestore().collection(&#x27;bids&#x27;).doc(id).delete().then(del &#x3D;&gt; {
                    const current_email &#x3D; localStorage.getItem(&#x27;email&#x27;)
                    const current_name &#x3D; localStorage.getItem(&#x27;name&#x27;)
                    this.config.logActivity(&#x60;${current_name}|${current_email} deleted this bid: ${name}&#x60;)
                    this.config.displayMessage(&quot;Successfully deleted&quot;, true);
                }).catch(err &#x3D;&gt; {
                    this.config.displayMessage(&#x60;${err}&#x60;, false);
                })
            } else {
                swal({
                    title: &#x27;Cancelled&#x27;,
                    text: &#x27;Deletion not successful&#x27;,
                    type: &#x27;error&#x27;,
                    confirmButtonClass: &quot;btn btn-info&quot;,
                    buttonsStyling: false
                }).catch(swal.noop)
            }
        })
    }

    /**
     * display more details of a bid when the edit button is clicked
     * @param {any} _id id of the bid
     */
    editProClick(_id: any) {
        const index &#x3D; Number(_id)
        this.editPro &#x3D; true
        this.addNewPro &#x3D; true
        this.currentProRow &#x3D; this.bids[index]

        //filter customer
        const customer &#x3D; this.dropDown_customers.filter((user, index, array) &#x3D;&gt; {
            return user.id &#x3D;&#x3D; this.currentProRow.customer_id
        })
        //filter product
        const product &#x3D; this.dropDown_products.filter((pro, index, array) &#x3D;&gt; {
            return pro.id &#x3D;&#x3D; this.currentProRow.product_id
        })
        //filter merchant
        const merchant &#x3D; this.dropDown_merchants.filter((mer, index, array) &#x3D;&gt; {
            return mer.id &#x3D;&#x3D; this.currentProRow.merchant_id
        })
        //filter bidrates
        const bidrate &#x3D; this.dropDown_bidrates.filter((bidr, index, array) &#x3D;&gt; {
            return bidr.id &#x3D;&#x3D; this.currentProRow.bid_rate_id
        })

        this.bid_value &#x3D; this.currentProRow.bid_value
        this.bid_rev &#x3D; this.currentProRow.bid_revenue
        this.bid_swipe_action &#x3D; this.currentProRow.bid_swipe_action
        this.status &#x3D; this.currentProRow.bid_status
        this.model_merchants &#x3D; merchant
        this.model_customers &#x3D; customer
        this.model_products &#x3D; product
        this.model_bidrates &#x3D; bidrate
    }

    ngAfterViewInit() {
        (&lt;any&gt;$(&#x27;#datatables&#x27;)).DataTable({
            &quot;pagingType&quot;: &quot;full_numbers&quot;,
            &quot;lengthMenu&quot;: [
                [10, 25, 50, -1],
                [10, 25, 50, &quot;All&quot;]
            ],
            responsive: true,
            language: {
                search: &quot;_INPUT_&quot;,
                searchPlaceholder: &quot;Search records&quot;,
            }

        });

        const table &#x3D; (&lt;any&gt;$(&#x27;#datatables&#x27;)).DataTable();
        //$(&#x27;&#x27;).modal()
        $(&#x27;.card .material-datatables label&#x27;).addClass(&#x27;form-group&#x27;);
    }

}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'DataTable-1.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
